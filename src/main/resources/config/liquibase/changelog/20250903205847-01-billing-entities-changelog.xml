<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.29.xsd"
  objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
  <changeSet id="1756925927757-1" author="halimzaaim">
    <createTable tableName="billing_coupon">
      <column name="id" type="${uuidType}">
        <constraints nullable="false" primaryKey="true" primaryKeyName="pk_billing_coupon"/>
      </column>
      <column name="code" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="discount" type="DECIMAL(19, 4)">
        <constraints nullable="false"/>
      </column>
      <column name="expiry_date" type="DATETIME">
        <constraints nullable="false"/>
      </column>
      <column name="discount_type" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="percentage" type="DECIMAL(5, 2)"/>
      <column name="currency" type="VARCHAR(3)"/>
      <column name="start_date" type="DATETIME"/>
      <column name="active" type="BOOLEAN">
        <constraints nullable="false"/>
      </column>
      <column name="max_redemptions" type="INT"/>
      <column name="times_redeemed" type="INT"/>
      <column name="version" type="BIGINT"/>
      <column name="created_by" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="created_date" type="DATETIME"/>
      <column name="last_modified_by" type="VARCHAR(50)"/>
      <column name="last_modified_date" type="DATETIME"/>
    </createTable>
  </changeSet>
  <changeSet id="1756925927757-2" author="halimzaaim">
    <createTable tableName="billing_feature">
      <column name="id" type="${uuidType}">
        <constraints nullable="false" primaryKey="true" primaryKeyName="pk_billing_feature"/>
      </column>
      <column name="name" type="VARCHAR(100)">
        <constraints nullable="false"/>
      </column>
      <column name="description" type="TEXT"/>
      <column name="code" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="category" type="VARCHAR(50)"/>
      <column name="active" type="BOOLEAN">
        <constraints nullable="false"/>
      </column>
      <column name="created_by" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="created_date" type="DATETIME"/>
      <column name="last_modified_by" type="VARCHAR(50)"/>
      <column name="last_modified_date" type="DATETIME"/>
      <column name="subscription_plan_id" type="${uuidType}"/>
    </createTable>
  </changeSet>
  <changeSet id="1756925927757-3" author="halimzaaim">
    <createTable tableName="billing_invoice">
      <column name="id" type="${uuidType}">
        <constraints nullable="false" primaryKey="true" primaryKeyName="pk_billing_invoice"/>
      </column>
      <column name="invoice_number" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="amount" type="DECIMAL(19, 4)">
        <constraints nullable="false"/>
      </column>
      <column name="tax_amount" type="DECIMAL(19, 4)"/>
      <column name="total_amount" type="DECIMAL(19, 4)">
        <constraints nullable="false"/>
      </column>
      <column name="status" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="issue_date" type="DATETIME">
        <constraints nullable="false"/>
      </column>
      <column name="due_date" type="DATETIME">
        <constraints nullable="false"/>
      </column>
      <column name="paid_date" type="DATETIME"/>
      <column name="subscription_id" type="${uuidType}">
        <constraints nullable="false"/>
      </column>
      <column name="tenant_id" type="${uuidType}">
        <constraints nullable="false"/>
      </column>
      <column name="notes" type="TEXT"/>
      <column name="currency" type="VARCHAR(3)">
        <constraints nullable="false"/>
      </column>
      <column name="created_by" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="created_date" type="DATETIME"/>
      <column name="last_modified_by" type="VARCHAR(50)"/>
      <column name="last_modified_date" type="DATETIME"/>
    </createTable>
  </changeSet>
  <changeSet id="1756925927757-4" author="halimzaaim">
    <createTable tableName="billing_payment">
      <column name="id" type="${uuidType}">
        <constraints nullable="false" primaryKey="true" primaryKeyName="pk_billing_payment"/>
      </column>
      <column name="amount" type="DECIMAL(19, 4)">
        <constraints nullable="false"/>
      </column>
      <column name="status" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="payment_date" type="DATETIME">
        <constraints nullable="false"/>
      </column>
      <column name="invoice_id" type="${uuidType}">
        <constraints nullable="false"/>
      </column>
      <column name="method" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="external_payment_id" type="VARCHAR(255)"/>
      <column name="failure_reason" type="VARCHAR(255)"/>
      <column name="refunded_amount" type="DECIMAL(19, 4)"/>
      <column name="retry_count" type="INT"/>
      <column name="next_retry_at" type="DATETIME"/>
      <column name="captured_at" type="DATETIME"/>
      <column name="currency_id" type="${uuidType}">
        <constraints nullable="false"/>
      </column>
      <column name="version" type="BIGINT"/>
      <column name="created_by" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="created_date" type="DATETIME"/>
      <column name="last_modified_by" type="VARCHAR(50)"/>
      <column name="last_modified_date" type="DATETIME"/>
    </createTable>
  </changeSet>
  <changeSet id="1756925927757-5" author="halimzaaim">
    <createTable tableName="billing_subscription">
      <column name="id" type="${uuidType}">
        <constraints nullable="false" primaryKey="true" primaryKeyName="pk_billing_subscription"/>
      </column>
      <column name="start_date" type="DATETIME">
        <constraints nullable="false"/>
      </column>
      <column name="end_date" type="DATETIME"/>
      <column name="status" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="auto_renew" type="BOOLEAN">
        <constraints nullable="false"/>
      </column>
      <column name="billing_cycle" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="current_period_start" type="DATETIME"/>
      <column name="current_period_end" type="DATETIME"/>
      <column name="cancel_at_period_end" type="BOOLEAN"/>
      <column name="trial_start" type="DATETIME"/>
      <column name="trial_end" type="DATETIME"/>
      <column name="subscription_plan_id" type="${uuidType}">
        <constraints nullable="false"/>
      </column>
      <column name="tenant_id" type="${uuidType}">
        <constraints nullable="false"/>
      </column>
      <column name="created_by" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="created_date" type="DATETIME"/>
      <column name="last_modified_by" type="VARCHAR(50)"/>
      <column name="last_modified_date" type="DATETIME"/>
    </createTable>
  </changeSet>
  <changeSet id="1756925927757-6" author="halimzaaim">
    <createTable tableName="billing_subscription_plan">
      <column name="id" type="${uuidType}">
        <constraints nullable="false" primaryKey="true" primaryKeyName="pk_billing_subscription_plan"/>
      </column>
      <column name="name" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="price" type="DECIMAL(19, 4)">
        <constraints nullable="false"/>
      </column>
      <column name="display_name" type="VARCHAR(100)"/>
      <column name="active" type="BOOLEAN">
        <constraints nullable="false"/>
      </column>
      <column name="base_price" type="DECIMAL(19, 4)"/>
      <column name="created_by" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="created_date" type="DATETIME"/>
      <column name="last_modified_by" type="VARCHAR(50)"/>
      <column name="last_modified_date" type="DATETIME"/>
    </createTable>
  </changeSet>
  <changeSet id="1756925927757-7" author="halimzaaim">
    <addUniqueConstraint columnNames="code" constraintName="uc_billing_coupon_code" tableName="billing_coupon"/>
  </changeSet>
  <changeSet id="1756925927757-8" author="halimzaaim">
    <addUniqueConstraint columnNames="code" constraintName="uc_billing_feature_code" tableName="billing_feature"/>
  </changeSet>
  <changeSet id="1756925927757-9" author="halimzaaim">
    <addUniqueConstraint columnNames="invoice_number" constraintName="uc_billing_invoice_invoice_number"
                         tableName="billing_invoice"/>
  </changeSet>
  <changeSet id="1756925927757-10" author="halimzaaim">
    <addForeignKeyConstraint baseColumnNames="subscription_plan_id" baseTableName="billing_feature"
                             constraintName="FK_BILLING_FEATURE_ON_SUBSCRIPTION_PLAN" referencedColumnNames="id"
                             referencedTableName="billing_subscription_plan"/>
  </changeSet>
  <changeSet id="1756925927757-11" author="halimzaaim">
    <addForeignKeyConstraint baseColumnNames="subscription_id" baseTableName="billing_invoice"
                             constraintName="FK_BILLING_INVOICE_ON_SUBSCRIPTION" referencedColumnNames="id"
                             referencedTableName="billing_subscription"/>
  </changeSet>
  <changeSet id="1756925927757-12" author="halimzaaim">
    <addForeignKeyConstraint baseColumnNames="tenant_id" baseTableName="billing_invoice"
                             constraintName="FK_BILLING_INVOICE_ON_TENANT" referencedColumnNames="id"
                             referencedTableName="tenant"/>
  </changeSet>
  <changeSet id="1756925927757-13" author="halimzaaim">
    <addForeignKeyConstraint baseColumnNames="currency_id" baseTableName="billing_payment"
                             constraintName="FK_BILLING_PAYMENT_ON_CURRENCY" referencedColumnNames="id"
                             referencedTableName="currency"/>
  </changeSet>
  <changeSet id="1756925927757-14" author="halimzaaim">
    <addForeignKeyConstraint baseColumnNames="invoice_id" baseTableName="billing_payment"
                             constraintName="FK_BILLING_PAYMENT_ON_INVOICE" referencedColumnNames="id"
                             referencedTableName="billing_invoice"/>
  </changeSet>
  <changeSet id="1756925927757-15" author="halimzaaim">
    <addForeignKeyConstraint baseColumnNames="subscription_plan_id" baseTableName="billing_subscription"
                             constraintName="FK_BILLING_SUBSCRIPTION_ON_SUBSCRIPTION_PLAN" referencedColumnNames="id"
                             referencedTableName="billing_subscription_plan"/>
  </changeSet>
  <changeSet id="1756925927757-16" author="halimzaaim">
    <addForeignKeyConstraint baseColumnNames="tenant_id" baseTableName="billing_subscription"
                             constraintName="FK_BILLING_SUBSCRIPTION_ON_TENANT" referencedColumnNames="id"
                             referencedTableName="tenant"/>
  </changeSet>

</databaseChangeLog>
